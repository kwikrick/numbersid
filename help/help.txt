Welcome to NumberSid
--------------------
NumberSid is a tool for making music from number sequences using the SID chip. The SID chip (MOS 6581/8580) is the sound chip of the venerable Commodore C64 computer. The chip's sound output is emulated by this program. Number sequences are generated using a few basic mathematical functions, using the time as the input, and using the output to control the chip: the frequencies of the oscillators, the waveforms, envelopes and the filter. The user sets the parameters of the functions to experimentally find interesting musical patterns.

Getting Started
---------------
Some things to try:
- Open the "Parameters" window from the "Sequencer" menu. Move it around and make it big enough to see all input fields.
- In the window, locate the GATE value for Voice 1.
- Replace the 0 with 1 (by typing in the edit box). 
- You should now hear a constant tone (440Hz). 
- Replace the 0 with (the letter) S.
- You should now hear a regular pattern of the same note (on-off-on-off...).
- Change the value of the NOTE from 0 to 1 (or 2 or -1 or anything). You will hear a different tone. 
- Change the value of the NOTE from 0 to A. You will now hear a simple melody. 
- Open the "Variables" window from the "Sequencer" menu, move and resize it to see all inputs. 
- Change the DIV1 value in row S, from 10 to 5. The pattern of note activations will now sound twice as fast.
- Change the MUL1 value in row A, from 2 to 31. The pattern of tone of the notes played will now change.


The sequencer windows
---------------------
The sequencer consists of four main parts: time control, parameters, variables and array. 

Time controls
-------------
Time is measured in ticks. There are 60 ticks in a second. This corresponds to the screen refresh rate of 60Hz.

The clock starts out running when starting the application, but can be frozen by unchecking "Run". The clock can also be controlled manually by typing a number or using the +/- buttons. Use "Reset" to reset the clock to 0.

When the clock is not running, the sound chip may still generate sound, but can be silenced using the "Mute" checkbox.

Parameters
----------
The SID chip has three channels, each with it's own oscillator and envelope generator. The sequencer has three voices, each corresponding to a channel. (Note: the terms are similar but not the same. A voice has logic that it implements on top of the SID's channels). The chip also has a single filter, through which each of the channels can be routed.

Each voice has a number of parameters that can be set, and the filter parameters can also be set in this window. Each parameter can be set to an integer value (range -32768 to 32767) or set to a variable, identified by a single letter A to Z. The values of the variables vary over time - these are the number sequences that are the core idea of the program. The values that are taken on by the variables are controlled in the "Variables" window. 

Note that all values (constants and variables) are 16 bit signed integers, ranging from -32768 to 32767. Some parameters are bit fields: Only some of the binary bits of the integer number are used, and different bits may have different meanings. 

Each voice has the following parameters:

GATE           Bit 0: 1 to open the channel, 0 to close. Or: odd and even numbers to open and close
NOTE           Note number in the scale (see below). May be negative. 0=root note
SCALE          12 bits: each bit represents a piano key in an octave. 0=all keys
TRANS          Number of semitones to transpose tone up or down
PITCH          Number of cents to pitch the tone up or down
WAVE           Waveform. Bit 0: Triangle. Bit 1: Sawtooth. Bit 2: Pulse. Bit 3: Noise (Noise cannot ne combined)
PULSEWIDTH     Duty cycle of the Pulse waveform. Range 0-4096 (12 bits). Used only if WAVE bit 2 set. 
RING           Bit 0: Enable ring modulation. Uses oscillator output of previous channel (voice 3 for voice 1)
SYNC           Bit 0: Enable synchronisation. Uses oscillator output of previous channel (voice 3 for voice 1)
ATTACK         Attack time of the envelope generator. Range 0-15 (4 bits)
DECAY          Decay time of the envelope generator. Range 0-15 (4 bits)
SUSTAIN        Sustain level of the envelope generator. Range 0-15 (4 bits)
RELEASE        Release time of the envelope generator. Range 0-15 (4 bits)
FILTER         Bit 0: if 1 then route channel output through filter, if 0 no filter

The filter has the following parameters:

MODE          Bit 0: lowpass, Bit 1: bandpass, Bit 2: high pass. Can be combined. (Bit 3 to silence voice 3) 
CUTOFF        Range 0-2047 (11 bits). Linearly related to frequency (approx. 30-12000Hz)
RESONANCE     Strength of filter resonance. Range 0-15 (4 bits)
VOLUME        Range 0-15 (4 bits)

When GATE goes from low to high, the attack phase of the envelope starts (and will continue into
decay and sustain phase). When GATE goes from low to high, the release phase of the envelope starts. 

The NOTE value is an index in a musical scale. SCALE a 12 bit number where each bit selects a semitone in an octave, i.e. the 12 piano keys in an octave. Each bit determines whether that key is part of the scale or not.
Examples: 
4095 = 111111111111 = chromatic scale
2741 = 101010110101 = C-major 
1352 = 010101001010 = A-minor 
0 = default = chromatic scale

NOTE value 0 is the first note in the scale of octave 0. Octave 0 always starts at 440Hz. Note 1 is the second note in the scale, Note -1 is the last note in the scale one octave lower, etc. If there are M notes in the scale, then octave=FLOOR(N/M) and index=FLOORMOD(N,M). Note that, the fewer notes are in a scale, the further apart two adjacent NOTE values will sound. From the octave and note index, we compute the corresponding semitone of the chromatic scale (i.e. which piano key), which is in turn converted to a frequency for the oscillator. The TRANS value allows to transpose the scale up or down by a number of semitones. The PITCH value allows the frequency to be tuned up or down by a given number of cents (100th of a semitone).

Variables
---------

The "Variables" window allows the variables to be specified that can be used in the "Parameters" section. Each variable is calculated each tick according the 
specification in this window. When a variable takes on different values over time, it creates a number sequence, which can be used to create music.

In this window, a table is displayed. Each table row corresponds to a variable, represented by a single captial letter, i.e. variables are named A-Z. Rows can be added and removed at the bottom, using the "+" and "-" buttons. Also, the order of rows can be swapped using the up and down arrow buttons in front of each row.

The first column (VAR) is the output variable of the sequence, and the other columns are inputs, and may contain values or variables. The second column (COUNT) is the starting value for the calculation, and typically a variable is used that counts time, e.g. T (see: Special variables). The other columns are parameters for subsequent operations to be performed on the value.

The meanings of the columns is as follows:
VAR             The output variable
COUNT           The starting value for the calculation (often a counting variable)
ADD1            Add parameter to the the current value
DIV1            Divide current value by given parameter. Skipped if 0. 
MUL1            Multiply current value by the given parameter.
MOD1            Take modulus of the current value and given parameter. Skipped if 0. 
BASE            Sum the digits of the current value when converted to a given base. Skipped if <2.
ARRAY           Take value from the array with this number, using current value as the index. Skipped if <1.  
MOD2            Take modulus of the current value and given parameter. Skipped if 0.
MUL2            Multiply current value by the given parameter.
DIV2            Divide current value by given parameter. Skipped if 0. 
ADD2            Add parameter to the the current value.

The order of the rows can be changed using the Up (^) an Down (v) buttons. This is relevant when one row uses the output variable from another row as input. The rows are evaluated from top to bottom. If you use a variable from a lower row, it's value will not have been calculated yet in this clock frame, and you'll get the previous value instead (it will sound 1/60th second behind). 

The BASE parameter allows to make many interesting number sequences. The "sum the number of digits in given base" operation results in fractal-like, self-similar patterns which can be used for complex melodies or rhythms. 
For example, if we count numbers in base 2:

decimal    base 2      sum of digits
-------------------------------------  
0          0           0
1          1           1
2         10           1
3         11           2
4        100           1
5        101           2
6        110           2
7        111           3
8       1000           1

So the sequence for BASE=2: 0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4... Notice that from a sequence of length 2^K, the sequence of double the length 2^(K+1) can be contructed by appending the first 2^K numbers and adding 1. So the sequence consists of increasingly long repetitions of the same pattern shifted up by 1. Using a step greater than 1 between the input numbers, results in very different patterns. This can be achieved using the MUL1 column. Some interesting patterns to try: set BASE=2 and MUL1=1,3,5,7,15,31,63... (2^K-1). Different BASE values also create different patterns, and the MOD1 and MOD2 values have interesting effects.  

The ARRAY parameter is useful when a particular set of numbers is needed, and also allows you to choose between sequences by using variables in the array. But the length and number of of arrays is (intentionally) limited. See "Arrays" window for more information. 

Note that the addition, multiplication, division and modulus operations appear twice in the sequence. The reason is that this allows to perform a linear transformation before the (non-linear) sum-of-digits (BASE) operation and a linear transformation after it. Also, because all intermediate values are integers, and rounded down after division, the order of the operations is important. The first set of operations allow to control the tempo at which the sequence plays and other time based characteristics of the sequence, while the second allows the control the range of values of the output variable.

When COUNT is a variable that linearly counts time (e.g. T), 
parameters can be used for the following effects:

ADD1   offset the sequence in time
DIV1   control tempo of the sequence
MUL1   set step size for the sum-of-digits, creates different patterns
MOD1   creates repetitions of sequence in time
BASE   create interesting number sequences
ARRAY  select from different sequences and special values 
MOD2   limit output range (introduces drops in value)
MUL2   multiply output range (larger steps)
DIV2   divide output range (rounded down)
ADD2   move output range up/down

Using variables for these parameters that alos change over time, allows the design of complex music.

Arrays
------
In the Array window, a collection of arrays can be defined in a table.

Arrays are numbered, starting from #1 (up to #16 in the current version),
displayed as rows of the table. Each array can have a variable number of elements displayed as columsn of the table, labeled [0], [1], [2]...(up to 16 elements, currently). Rows can be added and removed at the bottom, using the "+" and "-" buttons. Also, the order of rows can be swapped using the up and down arrow buttons in front of each row. The size of each array can be increased or decreased, adding columns to the right, usign the "+" and "-" buttons in each row. 

An array can contain integer values or variables. 

Arrays can be used in the construction of number sequences, by specifying an array number in the ARRAY column in the "Variables" window.  When the value in the ARRAY column is >=1 and <=16 (either specified directly by a number, or indirectly by a variable) the array with that number will be indexed. The index used is the current value of the sequence variable (VAR) in the calculation proces (i.e. the value obtained so far by applying the columns to the left of the ARRAY column). If the array contains a number at that index, the number is used in the rest of the calculation. If the array contains a variable at that index, the current value of that variable will be taken and used in the rest of the calculation.

Note that when an array is being indexed, and the array contains a variable that has not yet been calculated during the current tick, the previous value of that variable will be used, i.e. the value that was computed during the previous tick.

Special variables
-----------------
Some variables are set by the sequencer automatically and can be used as parameters. 

Most significant is T, which is the tick counter, which increments every 60th second. User defined sequences will typically derive from T. 

T     The number of ticks since the last reset. (Note overflows from 32767 to -32768). 

For each voice, the opening and closing of the GATE will control two other variables:

U     Voice 1 gate time, the number of ticks since Voice 1 GATE turned from 0 to 1
V     Voice 2 gate time, the number of ticks since Voice 2 GATE turned from 0 to 1
W     Voice 3 gate time, the number of ticks since Voice 3 GATE turned from 0 to 1

X     Voice 1 gate count, the number of times that Voice 1 GATE turned from 0 to 1
Y     Voice 2 gate count, the number of times that Voice 1 GATE turned from 0 to 1
Z     Voice 3 gate count, the number of times that Voice 1 GATE turned from 0 to 1

The UVW variables can be used to create effects that restart with each note, e.g. a pitch bend. 

The XYZ variables can be used to tie the progression notes played by a voice to the rhythm of the voice. 

Note: The variable that controls the voice gate should be evaluated before the the U,W,V,X,Y,Z values. So if variable A controls voice 1 gate, then A should be evaluated before (placed above) the rows where U or X are used. Otherwise, the value of the dependend variable will be one tick behind. 

Note: special variables can be used as output variables for sequences, but the values will be overwritten each tick before sequence evaluation. 

Data window
-----------
The data window allows exporting and importing the sequencer data as text. 

The "Export" button writes the current data into the text area in the window. Select all text (Ctrl+A) and copy it (Ctrl+C) into the clipboard. 
You may then store it any way you like, e.g. in a text file or use it in your favourite 6502 Assember. 

The "Import" button reads the values from the text area and updates the sequencer state. To use it, first clear the text area (using the "Clear" button) then paste any previously exported data in to the text area. Then press "Import". A popup will report succes or failure (due to incorrectly formatted or incomplete data).

Visualization windows
---------------------

Preview
-------
The preview windows allows the user to inspect the number sequences generated.

In top row of the table, type the single letter of a variable to display it in that column. 

The following rows correspond to subsequent frame numbers (tick count). If "follow" is checked, the frame numbers follow the time used by the sequencer. If unchecked, the user can set the start value for the frame number using "offset". The "step" value determines the time step between the frames shown in the preview. Increase it to skip values and show a longer time interval. 
Use the "+" and "-" buttons to add and remove columns to the table, to see more or fewer variables.  

Audio, SID, FFT
----------------
Visualization of the SID chip's internal state and the audio output. Inherited from the chips project. Maybe useful for diagnostics. The FFT (fast fourier transform) shows the frequency spectrum of the audio over time. It is also used as the screenshot for snapshots. 

System menu
-----------
Function "Reboot", resets the sequencer state, sound parameters and sequence parameters. 

Function "Save Snapshot" will save the sequencer state in a semi-permanent place. It can be retrieved using the "Load Snapshot" function. Each snapshot
is identified by an image of the FFT. 

Noet that snapshots are not stored in a file of your choosing, but in a temporary space. In the browser this is usually cleared when the browser cache is cleared. 
On desktop systems, the data is stored in the systems temporary files directory (which on systems is cleared when rebooting the system). To export data to a file or other permanent medium, use the Data window. 

History & Background
--------------------
Why would anyone want to make music this way? 

I wanted to create a very small (<4K) demo for the C64, and so there is very little space for storing a musical score. One way to achieve this is to generate the music using mathematically generated sequences and storing only the parameters of the mathematical functions used. 

However, implementing a interactive tool on the C64 in assembly language is very time consuming, and I also wanted to prototype different ideas for generating sequences. I found floooh's chips project to be a good fit for what I needed, (has a SID emulator, graphical UI and is cross-platform) and started from his code to create a proof of concept. 

Also, it's fun to find surprising musical patternsin maths. 

This program was inspired by a program called "Musinum - The music in the numbers" by Lars Kinderman. The idea of using the "sum of digits" function for music generation comes from him. Also, i used his idea for choosing notes from a musical scale to create more pleasing melodies and harmonies.
